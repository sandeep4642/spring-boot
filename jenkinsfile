@Library('jenkins-shared-library')_

pipeline {
    agent { label 'azure-agent' }

    environment {
      registry = 'kubernetesdemononprod.azurecr.io'
      dockerfile = 'Dockerfile'
      registryRepo = '/kubernetesdemononprod/spring-boot'
      imageURI = "${registry}${registryRepo}:${env.BUILD_NUMBER}"
    }

stages {


  stage('Demo') {
  when { allOf { environment name: 'app_type', value: 'java'} }  
      steps {
          script {
               build.mavenbuild()

        }
    }
    
  }

  stage('Docker Build') {
  when { allOf { environment name: 'app_type', value: 'java'} }  
      steps {
          script {
               build.buildDockerTaggedImage(registry, registryRepo, dockerfile)

        }
    }
    
  }
}
} 
